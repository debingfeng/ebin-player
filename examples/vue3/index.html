<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EbinPlayer Vue3 示例</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .player-container {
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-group label {
            font-size: 14px;
            font-weight: 500;
        }
        .control-group input, .control-group select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .status {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .status h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .status p {
            margin: 5px 0;
            color: #666;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .feature {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .feature h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .feature p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>🎬 EbinPlayer Vue3 示例</h1>
            <p>这是一个使用 @ebin-player/vue3 的完整示例，展示了组件的各种功能。</p>
            
            <div class="player-container">
                <ebin-player
                    ref="playerRef"
                    :src="videoSrc"
                    :ui-mode="uiMode"
                    :autoplay="autoplay"
                    :muted="muted"
                    :volume="volume"
                    :playback-rate="playbackRate"
                    :width="800"
                    :height="450"
                    :theme="customTheme"
                    :ui-config="uiConfig"
                    @ready="onReady"
                    @play="onPlay"
                    @pause="onPause"
                    @timeupdate="onTimeUpdate"
                    @volumechange="onVolumeChange"
                    @ratechange="onRateChange"
                    @ended="onEnded"
                    @error="onError"
                />
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>视频源:</label>
                    <select v-model="videoSrc">
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4">We Are Going On Bullrun</option>
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4">Big Buck Bunny</option>
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4">Sintel</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>UI模式:</label>
                    <select v-model="uiMode">
                        <option value="native">原生控制条</option>
                        <option value="custom">自定义UI</option>
                        <option value="none">无UI</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" v-model="autoplay" />
                        自动播放
                    </label>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" v-model="muted" />
                        静音
                    </label>
                </div>
                
                <div class="control-group">
                    <label>音量: {{ Math.round(volume * 100) }}%</label>
                    <input type="range" v-model="volume" min="0" max="1" step="0.1" />
                </div>
                
                <div class="control-group">
                    <label>播放速度: {{ playbackRate }}x</label>
                    <select v-model="playbackRate">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1">1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
            </div>

            <div class="status">
                <h3>播放器状态</h3>
                <p><strong>播放状态:</strong> {{ isPlaying ? '播放中' : '暂停' }}</p>
                <p><strong>当前时间:</strong> {{ formatTime(currentTime) }} / {{ formatTime(duration) }}</p>
                <p><strong>音量:</strong> {{ Math.round(volume * 100) }}% {{ muted ? '(静音)' : '' }}</p>
                <p><strong>播放速度:</strong> {{ playbackRate }}x</p>
                <p><strong>准备状态:</strong> {{ isReady ? '已准备' : '未准备' }}</p>
            </div>

            <div class="features">
                <div class="feature">
                    <h4>✅ Composition API</h4>
                    <p>使用Vue3的Composition API和setup语法</p>
                </div>
                <div class="feature">
                    <h4>✅ 响应式数据绑定</h4>
                    <p>所有播放器属性都支持Vue的响应式数据绑定</p>
                </div>
                <div class="feature">
                    <h4>✅ 事件监听</h4>
                    <p>支持所有HTML5视频事件和自定义事件</p>
                </div>
                <div class="feature">
                    <h4>✅ 主题定制</h4>
                    <p>支持完全自定义的UI主题和样式</p>
                </div>
                <div class="feature">
                    <h4>✅ 插件系统</h4>
                    <p>支持丰富的插件扩展功能</p>
                </div>
                <div class="feature">
                    <h4>✅ TypeScript支持</h4>
                    <p>提供完整的TypeScript类型定义</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { createApp, ref, computed, watch, nextTick } from 'https://unpkg.com/vue@3.3.0/dist/vue.esm-browser.js';
        import { EbinPlayer } from 'https://unpkg.com/@ebin-player/vue3@0.0.4/dist/index.js';

        // 注册组件
        const EbinPlayerComponent = {
            template: '<div ref="containerRef" :class="containerClassName" :style="containerStyle" v-bind="containerProps"></div>',
            props: {
                src: { required: true },
                uiMode: { default: 'advanced' },
                autoplay: { type: Boolean, default: false },
                muted: { type: Boolean, default: false },
                volume: { type: Number, default: 1 },
                playbackRate: { type: Number, default: 1 },
                width: [Number, String],
                height: [Number, String],
                theme: Object,
                uiConfig: Object,
                containerClassName: String,
                containerStyle: Object,
                containerProps: Object,
            },
            emits: ['ready', 'play', 'pause', 'timeupdate', 'volumechange', 'ratechange', 'ended', 'error'],
            setup(props, { emit }) {
                const containerRef = ref(null);
                const playerRef = ref(null);
                const isInitialized = ref(false);

                const containerStyle = computed(() => ({
                    width: props.width,
                    height: props.height,
                    ...props.containerStyle,
                }));

                const initializePlayer = () => {
                    const container = containerRef.value;
                    if (!container) return;

                    try {
                        const instance = new EbinPlayer(container, {
                            src: props.src,
                            uiMode: props.uiMode,
                            autoplay: props.autoplay,
                            muted: props.muted,
                            volume: props.volume,
                            playbackRate: props.playbackRate,
                            width: props.width,
                            height: props.height,
                            theme: props.theme,
                            uiConfig: props.uiConfig,
                        });

                        playerRef.value = instance;
                        bindEvents();
                        isInitialized.value = true;
                        emit('ready');
                    } catch (e) {
                        emit('error', e);
                    }
                };

                const bindEvents = () => {
                    if (!playerRef.value) return;

                    const events = ['play', 'pause', 'ended', 'error', 'loadedmetadata', 'timeupdate', 'volumechange', 'ratechange'];
                    events.forEach(event => {
                        playerRef.value.on(event, (eventData) => {
                            emit(event, eventData);
                        });
                    });
                };

                const destroyPlayer = () => {
                    if (playerRef.value) {
                        try {
                            playerRef.value.destroy();
                        } catch {}
                        playerRef.value = null;
                        isInitialized.value = false;
                    }
                };

                watch(() => props.src, () => {
                    destroyPlayer();
                    nextTick(() => {
                        initializePlayer();
                    });
                });

                watch(() => props.uiMode, () => {
                    destroyPlayer();
                    nextTick(() => {
                        initializePlayer();
                    });
                });

                watch(() => props.muted, (newVal) => {
                    if (playerRef.value) {
                        playerRef.value.setMuted(newVal);
                    }
                });

                watch(() => props.volume, (newVal) => {
                    if (playerRef.value) {
                        playerRef.value.setVolume(newVal);
                    }
                });

                watch(() => props.playbackRate, (newVal) => {
                    if (playerRef.value) {
                        playerRef.value.setPlaybackRate(newVal);
                    }
                });

                return {
                    containerRef,
                    playerRef,
                    containerStyle,
                    getInstance: () => playerRef.value,
                };
            },
            mounted() {
                this.initializePlayer();
            },
            beforeUnmount() {
                this.destroyPlayer();
            },
        };

        // 主应用
        createApp({
            components: {
                EbinPlayer: EbinPlayerComponent,
            },
            setup() {
                const videoSrc = ref('https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4');
                const uiMode = ref('advanced');
                const autoplay = ref(false);
                const muted = ref(false);
                const volume = ref(1);
                const playbackRate = ref(1);
                const isPlaying = ref(false);
                const currentTime = ref(0);
                const duration = ref(0);
                const isReady = ref(false);
                const playerRef = ref(null);

                const customTheme = ref({
                    primaryColor: '#007bff',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    textColor: '#ffffff',
                    controlBarHeight: 50,
                    borderRadius: 4,
                });

                const uiConfig = ref({
                    playButton: true,
                    progressBar: true,
                    timeDisplay: true,
                    volumeControl: true,
                    fullscreenButton: true,
                    playbackRateControl: true,
                });

                const onReady = () => {
                    console.log('播放器准备就绪');
                    isReady.value = true;
                };

                const onPlay = () => {
                    console.log('开始播放');
                    isPlaying.value = true;
                };

                const onPause = () => {
                    console.log('暂停播放');
                    isPlaying.value = false;
                };

                const onTimeUpdate = (time) => {
                    currentTime.value = time;
                    if (playerRef.value) {
                        duration.value = playerRef.value.getInstance().getDuration();
                    }
                };

                const onVolumeChange = (vol, isMuted) => {
                    volume.value = vol;
                    muted.value = isMuted;
                };

                const onRateChange = (rate) => {
                    playbackRate.value = rate;
                };

                const onEnded = () => {
                    console.log('播放结束');
                    isPlaying.value = false;
                };

                const onError = (error) => {
                    console.error('播放错误:', error);
                };

                const formatTime = (seconds) => {
                    if (!seconds || isNaN(seconds)) return '0:00';
                    const mins = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                };

                return {
                    videoSrc,
                    uiMode,
                    autoplay,
                    muted,
                    volume,
                    playbackRate,
                    isPlaying,
                    currentTime,
                    duration,
                    isReady,
                    playerRef,
                    customTheme,
                    uiConfig,
                    onReady,
                    onPlay,
                    onPause,
                    onTimeUpdate,
                    onVolumeChange,
                    onRateChange,
                    onEnded,
                    onError,
                    formatTime,
                };
            },
        }).mount('#app');
    </script>
</body>
</html>
