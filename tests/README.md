# æµ‹è¯•æ–‡æ¡£

æœ¬ç›®å½•åŒ…å«äº† Ebin Player çš„æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ï¼Œé‡‡ç”¨ Jest ä½œä¸ºæµ‹è¯•æ¡†æ¶ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ README.md                 # æµ‹è¯•æ–‡æ¡£
â”œâ”€â”€ index.ts                  # æµ‹è¯•å…¥å£æ–‡ä»¶
â”œâ”€â”€ setup.ts                  # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ utils.ts                  # æµ‹è¯•å·¥å…·å‡½æ•°
â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ PlayerCore.test.ts    # æ’­æ”¾å™¨æ ¸å¿ƒæµ‹è¯•
â”‚   â””â”€â”€ PlayerStore.test.ts   # çŠ¶æ€ç®¡ç†æµ‹è¯•
â”œâ”€â”€ ui/                       # UIç»„ä»¶æµ‹è¯•
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ PlayButton.test.ts # æ’­æ”¾æŒ‰é’®ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ plugin/                   # æ’ä»¶ç³»ç»Ÿæµ‹è¯•
â”‚   â””â”€â”€ BasePlugin.test.ts    # æ’ä»¶åŸºç±»æµ‹è¯•
â””â”€â”€ integration/              # é›†æˆæµ‹è¯•
    â””â”€â”€ PlayerIntegration.test.ts # æ’­æ”¾å™¨é›†æˆæµ‹è¯•
```

## ğŸš€ è¿è¡Œæµ‹è¯•

### åŸºç¡€å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# CIç¯å¢ƒè¿è¡Œæµ‹è¯•
npm run test:ci
```

### è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
# è¿è¡Œæ ¸å¿ƒæ¨¡å—æµ‹è¯•
npm test tests/core

# è¿è¡ŒUIç»„ä»¶æµ‹è¯•
npm test tests/ui

# è¿è¡Œæ’ä»¶æµ‹è¯•
npm test tests/plugin

# è¿è¡Œé›†æˆæµ‹è¯•
npm test tests/integration

# è¿è¡Œç‰¹å®šæ–‡ä»¶æµ‹è¯•
npm test PlayerCore.test.ts
```

## ğŸ“ æµ‹è¯•ç¼–å†™æŒ‡å—

### æµ‹è¯•æ–‡ä»¶å‘½å

- æµ‹è¯•æ–‡ä»¶å¿…é¡»ä»¥ `.test.ts` æˆ– `.spec.ts` ç»“å°¾
- æµ‹è¯•æ–‡ä»¶åº”è¯¥ä¸è¢«æµ‹è¯•çš„æ–‡ä»¶åŒå
- ä¾‹å¦‚ï¼š`PlayerCore.ts` å¯¹åº” `PlayerCore.test.ts`

### æµ‹è¯•ç»“æ„

```typescript
describe('ç»„ä»¶åç§°', () => {
  describe('åŠŸèƒ½åˆ†ç»„', () => {
    it('åº”è¯¥èƒ½å¤Ÿæ‰§è¡Œç‰¹å®šåŠŸèƒ½', () => {
      // æµ‹è¯•ä»£ç 
    });
  });
});
```

### æµ‹è¯•å·¥å…·ä½¿ç”¨

```typescript
import { 
  createTestContainer, 
  cleanupTestContainer, 
  createMockLogger,
  createTestData 
} from '../utils';

// åˆ›å»ºæµ‹è¯•å®¹å™¨
const container = createTestContainer();

// åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®
const playerOptions = createTestData.playerOptions({
  src: 'custom-video.mp4'
});

// æ¸…ç†æµ‹è¯•ç¯å¢ƒ
cleanupTestContainer();
```

## ğŸ”§ æµ‹è¯•é…ç½®

### Jest é…ç½®

æµ‹è¯•é…ç½®ä½äºé¡¹ç›®æ ¹ç›®å½•çš„ `jest.config.js` æ–‡ä»¶ä¸­ï¼Œä¸»è¦é…ç½®åŒ…æ‹¬ï¼š

- **æµ‹è¯•ç¯å¢ƒ**: jsdom (æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ)
- **TypeScriptæ”¯æŒ**: ä½¿ç”¨ ts-jest é¢„è®¾
- **è¦†ç›–ç‡é˜ˆå€¼**: 50% (å¯è°ƒæ•´)
- **æ¨¡å—æ˜ å°„**: æ”¯æŒè·¯å¾„åˆ«åå’ŒCSSæ¨¡å—

### æµ‹è¯•ç¯å¢ƒè®¾ç½®

`setup.ts` æ–‡ä»¶åŒ…å«äº†æµ‹è¯•ç¯å¢ƒçš„å…¨å±€è®¾ç½®ï¼š

- æ¨¡æ‹Ÿæµè§ˆå™¨API (matchMedia, ResizeObserverç­‰)
- æ¨¡æ‹ŸHTMLVideoElementæ–¹æ³•
- æ§åˆ¶å°è¾“å‡ºæ§åˆ¶
- DOMæ¸…ç†

## ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š

æµ‹è¯•è¿è¡Œåä¼šç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š

- **æ–‡æœ¬æŠ¥å‘Š**: åœ¨ç»ˆç«¯ä¸­æ˜¾ç¤º
- **HTMLæŠ¥å‘Š**: åœ¨ `coverage/lcov-report/index.html` ä¸­æŸ¥çœ‹
- **LCOVæŠ¥å‘Š**: ç”¨äºCI/CDé›†æˆ

### è¦†ç›–ç‡æŒ‡æ ‡

- **Statements**: è¯­å¥è¦†ç›–ç‡
- **Branches**: åˆ†æ”¯è¦†ç›–ç‡  
- **Functions**: å‡½æ•°è¦†ç›–ç‡
- **Lines**: è¡Œè¦†ç›–ç‡

## ğŸ› è°ƒè¯•æµ‹è¯•

### è°ƒè¯•å•ä¸ªæµ‹è¯•

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•å¹¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
npm test -- --verbose PlayerCore.test.ts

# è¿è¡Œæµ‹è¯•å¹¶ä¿æŒç›‘å¬
npm test -- --watch PlayerCore.test.ts
```

### è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨ console.log**: åœ¨æµ‹è¯•ä¸­æ·»åŠ æ—¥å¿—è¾“å‡º
2. **ä½¿ç”¨ debugger**: åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹
3. **ä½¿ç”¨ --no-cache**: æ¸…é™¤Jestç¼“å­˜
4. **ä½¿ç”¨ --detectOpenHandles**: æ£€æµ‹æœªå…³é—­çš„å¥æŸ„

## ğŸ“‹ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•éš”ç¦»

- æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ
- ä½¿ç”¨ `beforeEach` å’Œ `afterEach` æ¸…ç†çŠ¶æ€
- é¿å…æµ‹è¯•é—´çš„ä¾èµ–

### 2. æµ‹è¯•å‘½å

- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- éµå¾ª "åº”è¯¥èƒ½å¤Ÿ..." çš„å‘½åæ¨¡å¼
- åˆ†ç»„ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹

### 3. æ–­è¨€æ¸…æ™°

- ä½¿ç”¨å…·ä½“çš„æ–­è¨€è€Œä¸æ˜¯é€šç”¨çš„ `toBeTruthy()`
- æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
- æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯æƒ…å†µ

### 4. æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–

- æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å’ŒAPIè°ƒç”¨
- æ¨¡æ‹ŸDOMæ“ä½œå’Œæµè§ˆå™¨äº‹ä»¶
- ä½¿ç”¨ Jest çš„æ¨¡æ‹ŸåŠŸèƒ½

### 5. æ€§èƒ½è€ƒè™‘

- é¿å…åœ¨æµ‹è¯•ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- ä½¿ç”¨ `jest.setTimeout()` è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- æ¸…ç†å®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨

## ğŸ”„ æŒç»­é›†æˆ

æµ‹è¯•é…ç½®æ”¯æŒCI/CDç¯å¢ƒï¼š

- ä½¿ç”¨ `npm run test:ci` åœ¨CIä¸­è¿è¡Œ
- ç”ŸæˆLCOVè¦†ç›–ç‡æŠ¥å‘Š
- è®¾ç½®è¦†ç›–ç‡é˜ˆå€¼æ£€æŸ¥
- æ”¯æŒå¹¶è¡Œæµ‹è¯•æ‰§è¡Œ

## ğŸ“š ç›¸å…³èµ„æº

- [Jest å®˜æ–¹æ–‡æ¡£](https://jestjs.io/docs/getting-started)
- [Testing Library æ–‡æ¡£](https://testing-library.com/docs/)
- [TypeScript æµ‹è¯•æŒ‡å—](https://jestjs.io/docs/getting-started#using-typescript)
