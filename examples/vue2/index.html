<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EbinPlayer Vue2 示例</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .player-container {
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-group label {
            font-size: 14px;
            font-weight: 500;
        }
        .control-group input, .control-group select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .status {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .status h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .status p {
            margin: 5px 0;
            color: #666;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .feature {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .feature h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .feature p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>🎬 EbinPlayer Vue2 示例</h1>
            <p>这是一个使用 @ebin-player/vue2 的完整示例，展示了组件的各种功能。</p>
            
            <div class="player-container">
                <ebin-player
                    ref="player"
                    :src="videoSrc"
                    :ui-mode="uiMode"
                    :autoplay="autoplay"
                    :muted="muted"
                    :volume="volume"
                    :playback-rate="playbackRate"
                    :width="800"
                    :height="450"
                    :theme="customTheme"
                    :ui-config="uiConfig"
                    @ready="onReady"
                    @play="onPlay"
                    @pause="onPause"
                    @timeupdate="onTimeUpdate"
                    @volumechange="onVolumeChange"
                    @ratechange="onRateChange"
                    @ended="onEnded"
                    @error="onError"
                />
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>视频源:</label>
                    <select v-model="videoSrc">
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4">We Are Going On Bullrun</option>
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4">Big Buck Bunny</option>
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4">Sintel</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>UI模式:</label>
                    <select v-model="uiMode">
                        <option value="native">原生控制条</option>
                        <option value="custom">自定义UI</option>
                        <option value="none">无UI</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" v-model="autoplay" />
                        自动播放
                    </label>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" v-model="muted" />
                        静音
                    </label>
                </div>
                
                <div class="control-group">
                    <label>音量: {{ Math.round(volume * 100) }}%</label>
                    <input type="range" v-model="volume" min="0" max="1" step="0.1" />
                </div>
                
                <div class="control-group">
                    <label>播放速度: {{ playbackRate }}x</label>
                    <select v-model="playbackRate">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1">1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
            </div>

            <div class="status">
                <h3>播放器状态</h3>
                <p><strong>播放状态:</strong> {{ isPlaying ? '播放中' : '暂停' }}</p>
                <p><strong>当前时间:</strong> {{ formatTime(currentTime) }} / {{ formatTime(duration) }}</p>
                <p><strong>音量:</strong> {{ Math.round(volume * 100) }}% {{ muted ? '(静音)' : '' }}</p>
                <p><strong>播放速度:</strong> {{ playbackRate }}x</p>
                <p><strong>准备状态:</strong> {{ isReady ? '已准备' : '未准备' }}</p>
            </div>

            <div class="features">
                <div class="feature">
                    <h4>✅ 响应式数据绑定</h4>
                    <p>所有播放器属性都支持Vue的响应式数据绑定</p>
                </div>
                <div class="feature">
                    <h4>✅ 事件监听</h4>
                    <p>支持所有HTML5视频事件和自定义事件</p>
                </div>
                <div class="feature">
                    <h4>✅ 主题定制</h4>
                    <p>支持完全自定义的UI主题和样式</p>
                </div>
                <div class="feature">
                    <h4>✅ 插件系统</h4>
                    <p>支持丰富的插件扩展功能</p>
                </div>
                <div class="feature">
                    <h4>✅ TypeScript支持</h4>
                    <p>提供完整的TypeScript类型定义</p>
                </div>
                <div class="feature">
                    <h4>✅ 服务端渲染</h4>
                    <p>支持Vue的SSR服务端渲染</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2.7.14/dist/vue.min.js"></script>
    <script src="../../dist/ebin-player.umd.js"></script>
    <script>
        // 注册组件
        Vue.component('ebin-player', {
            template: '<div ref="container" :class="containerClassName" :style="containerStyle" v-bind="containerProps"></div>',
            props: {
                src: { required: true },
                uiMode: { default: 'advanced' },
                autoplay: { type: Boolean, default: false },
                muted: { type: Boolean, default: false },
                volume: { type: Number, default: 1 },
                playbackRate: { type: Number, default: 1 },
                width: [Number, String],
                height: [Number, String],
                theme: Object,
                uiConfig: Object,
                containerClassName: String,
                containerStyle: Object,
                containerProps: Object,
            },
            data() {
                return {
                    player: null,
                    isInitialized: false,
                };
            },
            computed: {
                containerStyle() {
                    return {
                        width: this.width,
                        height: this.height,
                        ...this.containerStyle,
                    };
                },
            },
            watch: {
                src() {
                    this.reinitialize();
                },
                uiMode() {
                    this.reinitialize();
                },
                muted(newVal) {
                    if (this.player) {
                        this.player.setMuted(newVal);
                    }
                },
                volume(newVal) {
                    if (this.player) {
                        this.player.setVolume(newVal);
                    }
                },
                playbackRate(newVal) {
                    if (this.player) {
                        this.player.setPlaybackRate(newVal);
                    }
                },
            },
            mounted() {
                this.initializePlayer();
            },
            beforeDestroy() {
                this.destroyPlayer();
            },
            methods: {
                initializePlayer() {
                    const container = this.$refs.container;
                    if (!container) return;

                    try {
                        const instance = new EbinPlayer(container, {
                            src: this.src,
                            uiMode: this.uiMode,
                            autoplay: this.autoplay,
                            muted: this.muted,
                            volume: this.volume,
                            playbackRate: this.playbackRate,
                            width: this.width,
                            height: this.height,
                            theme: this.theme,
                            uiConfig: this.uiConfig,
                        });

                        this.player = instance;
                        this.bindEvents();
                        this.isInitialized = true;
                        this.$emit('ready');
                    } catch (e) {
                        this.$emit('error', e);
                    }
                },
                bindEvents() {
                    if (!this.player) return;

                    const events = ['play', 'pause', 'ended', 'error', 'loadedmetadata', 'timeupdate', 'volumechange', 'ratechange'];
                    events.forEach(event => {
                        this.player.on(event, (eventData) => {
                            this.$emit(event, eventData);
                        });
                    });
                },
                reinitialize() {
                    this.destroyPlayer();
                    this.$nextTick(() => {
                        this.initializePlayer();
                    });
                },
                destroyPlayer() {
                    if (this.player) {
                        try {
                            this.player.destroy();
                        } catch {}
                        this.player = null;
                        this.isInitialized = false;
                    }
                },
                getInstance() {
                    return this.player;
                },
            },
        });

        // 主应用
        new Vue({
            el: '#app',
            data: {
                videoSrc: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4',
                uiMode: 'advanced',
                autoplay: false,
                muted: false,
                volume: 1,
                playbackRate: 1,
                isPlaying: false,
                currentTime: 0,
                duration: 0,
                isReady: false,
                customTheme: {
                    primaryColor: '#007bff',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    textColor: '#ffffff',
                    controlBarHeight: 50,
                    borderRadius: 4,
                },
                uiConfig: {
                    playButton: true,
                    progressBar: true,
                    timeDisplay: true,
                    volumeControl: true,
                    fullscreenButton: true,
                    playbackRateControl: true,
                },
            },
            methods: {
                onReady() {
                    console.log('播放器准备就绪');
                    this.isReady = true;
                },
                onPlay() {
                    console.log('开始播放');
                    this.isPlaying = true;
                },
                onPause() {
                    console.log('暂停播放');
                    this.isPlaying = false;
                },
                onTimeUpdate(time) {
                    this.currentTime = time;
                    if (this.player) {
                        this.duration = this.player.getInstance().getDuration();
                    }
                },
                onVolumeChange(volume, muted) {
                    this.volume = volume;
                    this.muted = muted;
                },
                onRateChange(rate) {
                    this.playbackRate = rate;
                },
                onEnded() {
                    console.log('播放结束');
                    this.isPlaying = false;
                },
                onError(error) {
                    console.error('播放错误:', error);
                },
                formatTime(seconds) {
                    if (!seconds || isNaN(seconds)) return '0:00';
                    const mins = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                },
            },
        });
    </script>
</body>
</html>
