<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EbinPlayer Vue3 ç¤ºä¾‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .player-container {
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-group label {
            font-size: 14px;
            font-weight: 500;
        }
        .control-group input, .control-group select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .status {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .status h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .status p {
            margin: 5px 0;
            color: #666;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .feature {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .feature h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .feature p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>ğŸ¬ EbinPlayer Vue3 ç¤ºä¾‹</h1>
            <p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ @ebin-player/vue3 çš„å®Œæ•´ç¤ºä¾‹ï¼Œå±•ç¤ºäº†ç»„ä»¶çš„å„ç§åŠŸèƒ½ã€‚</p>
            
            <div class="player-container">
                <ebin-player
                    ref="playerRef"
                    :src="videoSrc"
                    :ui-mode="uiMode"
                    :autoplay="autoplay"
                    :muted="muted"
                    :volume="volume"
                    :playback-rate="playbackRate"
                    :width="800"
                    :height="450"
                    :theme="customTheme"
                    :ui-config="uiConfig"
                    @ready="onReady"
                    @play="onPlay"
                    @pause="onPause"
                    @timeupdate="onTimeUpdate"
                    @volumechange="onVolumeChange"
                    @ratechange="onRateChange"
                    @ended="onEnded"
                    @error="onError"
                />
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>è§†é¢‘æº:</label>
                    <select v-model="videoSrc">
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4">We Are Going On Bullrun</option>
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4">Big Buck Bunny</option>
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4">Sintel</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>UIæ¨¡å¼:</label>
                    <select v-model="uiMode">
                        <option value="native">åŸç”Ÿæ§åˆ¶æ¡</option>
                        <option value="custom">è‡ªå®šä¹‰UI</option>
                        <option value="none">æ— UI</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" v-model="autoplay" />
                        è‡ªåŠ¨æ’­æ”¾
                    </label>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" v-model="muted" />
                        é™éŸ³
                    </label>
                </div>
                
                <div class="control-group">
                    <label>éŸ³é‡: {{ Math.round(volume * 100) }}%</label>
                    <input type="range" v-model="volume" min="0" max="1" step="0.1" />
                </div>
                
                <div class="control-group">
                    <label>æ’­æ”¾é€Ÿåº¦: {{ playbackRate }}x</label>
                    <select v-model="playbackRate">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1">1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
            </div>

            <div class="status">
                <h3>æ’­æ”¾å™¨çŠ¶æ€</h3>
                <p><strong>æ’­æ”¾çŠ¶æ€:</strong> {{ isPlaying ? 'æ’­æ”¾ä¸­' : 'æš‚åœ' }}</p>
                <p><strong>å½“å‰æ—¶é—´:</strong> {{ formatTime(currentTime) }} / {{ formatTime(duration) }}</p>
                <p><strong>éŸ³é‡:</strong> {{ Math.round(volume * 100) }}% {{ muted ? '(é™éŸ³)' : '' }}</p>
                <p><strong>æ’­æ”¾é€Ÿåº¦:</strong> {{ playbackRate }}x</p>
                <p><strong>å‡†å¤‡çŠ¶æ€:</strong> {{ isReady ? 'å·²å‡†å¤‡' : 'æœªå‡†å¤‡' }}</p>
            </div>

            <div class="features">
                <div class="feature">
                    <h4>âœ… Composition API</h4>
                    <p>ä½¿ç”¨Vue3çš„Composition APIå’Œsetupè¯­æ³•</p>
                </div>
                <div class="feature">
                    <h4>âœ… å“åº”å¼æ•°æ®ç»‘å®š</h4>
                    <p>æ‰€æœ‰æ’­æ”¾å™¨å±æ€§éƒ½æ”¯æŒVueçš„å“åº”å¼æ•°æ®ç»‘å®š</p>
                </div>
                <div class="feature">
                    <h4>âœ… äº‹ä»¶ç›‘å¬</h4>
                    <p>æ”¯æŒæ‰€æœ‰HTML5è§†é¢‘äº‹ä»¶å’Œè‡ªå®šä¹‰äº‹ä»¶</p>
                </div>
                <div class="feature">
                    <h4>âœ… ä¸»é¢˜å®šåˆ¶</h4>
                    <p>æ”¯æŒå®Œå…¨è‡ªå®šä¹‰çš„UIä¸»é¢˜å’Œæ ·å¼</p>
                </div>
                <div class="feature">
                    <h4>âœ… æ’ä»¶ç³»ç»Ÿ</h4>
                    <p>æ”¯æŒä¸°å¯Œçš„æ’ä»¶æ‰©å±•åŠŸèƒ½</p>
                </div>
                <div class="feature">
                    <h4>âœ… TypeScriptæ”¯æŒ</h4>
                    <p>æä¾›å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { createApp, ref, computed, watch, nextTick } from 'https://unpkg.com/vue@3.3.0/dist/vue.esm-browser.js';
        import { EbinPlayer } from 'https://unpkg.com/@ebin-player/vue3@0.0.4/dist/index.js';

        // æ³¨å†Œç»„ä»¶
        const EbinPlayerComponent = {
            template: '<div ref="containerRef" :class="containerClassName" :style="containerStyle" v-bind="containerProps"></div>',
            props: {
                src: { required: true },
                uiMode: { default: 'advanced' },
                autoplay: { type: Boolean, default: false },
                muted: { type: Boolean, default: false },
                volume: { type: Number, default: 1 },
                playbackRate: { type: Number, default: 1 },
                width: [Number, String],
                height: [Number, String],
                theme: Object,
                uiConfig: Object,
                containerClassName: String,
                containerStyle: Object,
                containerProps: Object,
            },
            emits: ['ready', 'play', 'pause', 'timeupdate', 'volumechange', 'ratechange', 'ended', 'error'],
            setup(props, { emit }) {
                const containerRef = ref(null);
                const playerRef = ref(null);
                const isInitialized = ref(false);

                const containerStyle = computed(() => ({
                    width: props.width,
                    height: props.height,
                    ...props.containerStyle,
                }));

                const initializePlayer = () => {
                    const container = containerRef.value;
                    if (!container) return;

                    try {
                        const instance = new EbinPlayer(container, {
                            src: props.src,
                            uiMode: props.uiMode,
                            autoplay: props.autoplay,
                            muted: props.muted,
                            volume: props.volume,
                            playbackRate: props.playbackRate,
                            width: props.width,
                            height: props.height,
                            theme: props.theme,
                            uiConfig: props.uiConfig,
                        });

                        playerRef.value = instance;
                        bindEvents();
                        isInitialized.value = true;
                        emit('ready');
                    } catch (e) {
                        emit('error', e);
                    }
                };

                const bindEvents = () => {
                    if (!playerRef.value) return;

                    const events = ['play', 'pause', 'ended', 'error', 'loadedmetadata', 'timeupdate', 'volumechange', 'ratechange'];
                    events.forEach(event => {
                        playerRef.value.on(event, (eventData) => {
                            emit(event, eventData);
                        });
                    });
                };

                const destroyPlayer = () => {
                    if (playerRef.value) {
                        try {
                            playerRef.value.destroy();
                        } catch {}
                        playerRef.value = null;
                        isInitialized.value = false;
                    }
                };

                watch(() => props.src, () => {
                    destroyPlayer();
                    nextTick(() => {
                        initializePlayer();
                    });
                });

                watch(() => props.uiMode, () => {
                    destroyPlayer();
                    nextTick(() => {
                        initializePlayer();
                    });
                });

                watch(() => props.muted, (newVal) => {
                    if (playerRef.value) {
                        playerRef.value.setMuted(newVal);
                    }
                });

                watch(() => props.volume, (newVal) => {
                    if (playerRef.value) {
                        playerRef.value.setVolume(newVal);
                    }
                });

                watch(() => props.playbackRate, (newVal) => {
                    if (playerRef.value) {
                        playerRef.value.setPlaybackRate(newVal);
                    }
                });

                return {
                    containerRef,
                    playerRef,
                    containerStyle,
                    getInstance: () => playerRef.value,
                };
            },
            mounted() {
                this.initializePlayer();
            },
            beforeUnmount() {
                this.destroyPlayer();
            },
        };

        // ä¸»åº”ç”¨
        createApp({
            components: {
                EbinPlayer: EbinPlayerComponent,
            },
            setup() {
                const videoSrc = ref('https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4');
                const uiMode = ref('advanced');
                const autoplay = ref(false);
                const muted = ref(false);
                const volume = ref(1);
                const playbackRate = ref(1);
                const isPlaying = ref(false);
                const currentTime = ref(0);
                const duration = ref(0);
                const isReady = ref(false);
                const playerRef = ref(null);

                const customTheme = ref({
                    primaryColor: '#007bff',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    textColor: '#ffffff',
                    controlBarHeight: 50,
                    borderRadius: 4,
                });

                const uiConfig = ref({
                    playButton: true,
                    progressBar: true,
                    timeDisplay: true,
                    volumeControl: true,
                    fullscreenButton: true,
                    playbackRateControl: true,
                });

                const onReady = () => {
                    console.log('æ’­æ”¾å™¨å‡†å¤‡å°±ç»ª');
                    isReady.value = true;
                };

                const onPlay = () => {
                    console.log('å¼€å§‹æ’­æ”¾');
                    isPlaying.value = true;
                };

                const onPause = () => {
                    console.log('æš‚åœæ’­æ”¾');
                    isPlaying.value = false;
                };

                const onTimeUpdate = (time) => {
                    currentTime.value = time;
                    if (playerRef.value) {
                        duration.value = playerRef.value.getInstance().getDuration();
                    }
                };

                const onVolumeChange = (vol, isMuted) => {
                    volume.value = vol;
                    muted.value = isMuted;
                };

                const onRateChange = (rate) => {
                    playbackRate.value = rate;
                };

                const onEnded = () => {
                    console.log('æ’­æ”¾ç»“æŸ');
                    isPlaying.value = false;
                };

                const onError = (error) => {
                    console.error('æ’­æ”¾é”™è¯¯:', error);
                };

                const formatTime = (seconds) => {
                    if (!seconds || isNaN(seconds)) return '0:00';
                    const mins = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                };

                return {
                    videoSrc,
                    uiMode,
                    autoplay,
                    muted,
                    volume,
                    playbackRate,
                    isPlaying,
                    currentTime,
                    duration,
                    isReady,
                    playerRef,
                    customTheme,
                    uiConfig,
                    onReady,
                    onPlay,
                    onPause,
                    onTimeUpdate,
                    onVolumeChange,
                    onRateChange,
                    onEnded,
                    onError,
                    formatTime,
                };
            },
        }).mount('#app');
    </script>
</body>
</html>
