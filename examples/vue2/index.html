<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EbinPlayer Vue2 ç¤ºä¾‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .player-container {
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-group label {
            font-size: 14px;
            font-weight: 500;
        }
        .control-group input, .control-group select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .status {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .status h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .status p {
            margin: 5px 0;
            color: #666;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .feature {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .feature h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .feature p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>ğŸ¬ EbinPlayer Vue2 ç¤ºä¾‹</h1>
            <p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ @ebin-player/vue2 çš„å®Œæ•´ç¤ºä¾‹ï¼Œå±•ç¤ºäº†ç»„ä»¶çš„å„ç§åŠŸèƒ½ã€‚</p>
            
            <div class="player-container">
                <ebin-player
                    ref="player"
                    :src="videoSrc"
                    :ui-mode="uiMode"
                    :autoplay="autoplay"
                    :muted="muted"
                    :volume="volume"
                    :playback-rate="playbackRate"
                    :width="800"
                    :height="450"
                    :theme="customTheme"
                    :ui-config="uiConfig"
                    @ready="onReady"
                    @play="onPlay"
                    @pause="onPause"
                    @timeupdate="onTimeUpdate"
                    @volumechange="onVolumeChange"
                    @ratechange="onRateChange"
                    @ended="onEnded"
                    @error="onError"
                />
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>è§†é¢‘æº:</label>
                    <select v-model="videoSrc">
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4">We Are Going On Bullrun</option>
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4">Big Buck Bunny</option>
                        <option value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4">Sintel</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>UIæ¨¡å¼:</label>
                    <select v-model="uiMode">
                        <option value="native">åŸç”Ÿæ§åˆ¶æ¡</option>
                        <option value="custom">è‡ªå®šä¹‰UI</option>
                        <option value="none">æ— UI</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" v-model="autoplay" />
                        è‡ªåŠ¨æ’­æ”¾
                    </label>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" v-model="muted" />
                        é™éŸ³
                    </label>
                </div>
                
                <div class="control-group">
                    <label>éŸ³é‡: {{ Math.round(volume * 100) }}%</label>
                    <input type="range" v-model="volume" min="0" max="1" step="0.1" />
                </div>
                
                <div class="control-group">
                    <label>æ’­æ”¾é€Ÿåº¦: {{ playbackRate }}x</label>
                    <select v-model="playbackRate">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1">1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
            </div>

            <div class="status">
                <h3>æ’­æ”¾å™¨çŠ¶æ€</h3>
                <p><strong>æ’­æ”¾çŠ¶æ€:</strong> {{ isPlaying ? 'æ’­æ”¾ä¸­' : 'æš‚åœ' }}</p>
                <p><strong>å½“å‰æ—¶é—´:</strong> {{ formatTime(currentTime) }} / {{ formatTime(duration) }}</p>
                <p><strong>éŸ³é‡:</strong> {{ Math.round(volume * 100) }}% {{ muted ? '(é™éŸ³)' : '' }}</p>
                <p><strong>æ’­æ”¾é€Ÿåº¦:</strong> {{ playbackRate }}x</p>
                <p><strong>å‡†å¤‡çŠ¶æ€:</strong> {{ isReady ? 'å·²å‡†å¤‡' : 'æœªå‡†å¤‡' }}</p>
            </div>

            <div class="features">
                <div class="feature">
                    <h4>âœ… å“åº”å¼æ•°æ®ç»‘å®š</h4>
                    <p>æ‰€æœ‰æ’­æ”¾å™¨å±æ€§éƒ½æ”¯æŒVueçš„å“åº”å¼æ•°æ®ç»‘å®š</p>
                </div>
                <div class="feature">
                    <h4>âœ… äº‹ä»¶ç›‘å¬</h4>
                    <p>æ”¯æŒæ‰€æœ‰HTML5è§†é¢‘äº‹ä»¶å’Œè‡ªå®šä¹‰äº‹ä»¶</p>
                </div>
                <div class="feature">
                    <h4>âœ… ä¸»é¢˜å®šåˆ¶</h4>
                    <p>æ”¯æŒå®Œå…¨è‡ªå®šä¹‰çš„UIä¸»é¢˜å’Œæ ·å¼</p>
                </div>
                <div class="feature">
                    <h4>âœ… æ’ä»¶ç³»ç»Ÿ</h4>
                    <p>æ”¯æŒä¸°å¯Œçš„æ’ä»¶æ‰©å±•åŠŸèƒ½</p>
                </div>
                <div class="feature">
                    <h4>âœ… TypeScriptæ”¯æŒ</h4>
                    <p>æä¾›å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰</p>
                </div>
                <div class="feature">
                    <h4>âœ… æœåŠ¡ç«¯æ¸²æŸ“</h4>
                    <p>æ”¯æŒVueçš„SSRæœåŠ¡ç«¯æ¸²æŸ“</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2.7.14/dist/vue.min.js"></script>
    <script src="../../dist/ebin-player.umd.js"></script>
    <script>
        // æ³¨å†Œç»„ä»¶
        Vue.component('ebin-player', {
            template: '<div ref="container" :class="containerClassName" :style="containerStyle" v-bind="containerProps"></div>',
            props: {
                src: { required: true },
                uiMode: { default: 'advanced' },
                autoplay: { type: Boolean, default: false },
                muted: { type: Boolean, default: false },
                volume: { type: Number, default: 1 },
                playbackRate: { type: Number, default: 1 },
                width: [Number, String],
                height: [Number, String],
                theme: Object,
                uiConfig: Object,
                containerClassName: String,
                containerStyle: Object,
                containerProps: Object,
            },
            data() {
                return {
                    player: null,
                    isInitialized: false,
                };
            },
            computed: {
                containerStyle() {
                    return {
                        width: this.width,
                        height: this.height,
                        ...this.containerStyle,
                    };
                },
            },
            watch: {
                src() {
                    this.reinitialize();
                },
                uiMode() {
                    this.reinitialize();
                },
                muted(newVal) {
                    if (this.player) {
                        this.player.setMuted(newVal);
                    }
                },
                volume(newVal) {
                    if (this.player) {
                        this.player.setVolume(newVal);
                    }
                },
                playbackRate(newVal) {
                    if (this.player) {
                        this.player.setPlaybackRate(newVal);
                    }
                },
            },
            mounted() {
                this.initializePlayer();
            },
            beforeDestroy() {
                this.destroyPlayer();
            },
            methods: {
                initializePlayer() {
                    const container = this.$refs.container;
                    if (!container) return;

                    try {
                        const instance = new EbinPlayer(container, {
                            src: this.src,
                            uiMode: this.uiMode,
                            autoplay: this.autoplay,
                            muted: this.muted,
                            volume: this.volume,
                            playbackRate: this.playbackRate,
                            width: this.width,
                            height: this.height,
                            theme: this.theme,
                            uiConfig: this.uiConfig,
                        });

                        this.player = instance;
                        this.bindEvents();
                        this.isInitialized = true;
                        this.$emit('ready');
                    } catch (e) {
                        this.$emit('error', e);
                    }
                },
                bindEvents() {
                    if (!this.player) return;

                    const events = ['play', 'pause', 'ended', 'error', 'loadedmetadata', 'timeupdate', 'volumechange', 'ratechange'];
                    events.forEach(event => {
                        this.player.on(event, (eventData) => {
                            this.$emit(event, eventData);
                        });
                    });
                },
                reinitialize() {
                    this.destroyPlayer();
                    this.$nextTick(() => {
                        this.initializePlayer();
                    });
                },
                destroyPlayer() {
                    if (this.player) {
                        try {
                            this.player.destroy();
                        } catch {}
                        this.player = null;
                        this.isInitialized = false;
                    }
                },
                getInstance() {
                    return this.player;
                },
            },
        });

        // ä¸»åº”ç”¨
        new Vue({
            el: '#app',
            data: {
                videoSrc: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/WeAreGoingOnBullrun.mp4',
                uiMode: 'advanced',
                autoplay: false,
                muted: false,
                volume: 1,
                playbackRate: 1,
                isPlaying: false,
                currentTime: 0,
                duration: 0,
                isReady: false,
                customTheme: {
                    primaryColor: '#007bff',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    textColor: '#ffffff',
                    controlBarHeight: 50,
                    borderRadius: 4,
                },
                uiConfig: {
                    playButton: true,
                    progressBar: true,
                    timeDisplay: true,
                    volumeControl: true,
                    fullscreenButton: true,
                    playbackRateControl: true,
                },
            },
            methods: {
                onReady() {
                    console.log('æ’­æ”¾å™¨å‡†å¤‡å°±ç»ª');
                    this.isReady = true;
                },
                onPlay() {
                    console.log('å¼€å§‹æ’­æ”¾');
                    this.isPlaying = true;
                },
                onPause() {
                    console.log('æš‚åœæ’­æ”¾');
                    this.isPlaying = false;
                },
                onTimeUpdate(time) {
                    this.currentTime = time;
                    if (this.player) {
                        this.duration = this.player.getInstance().getDuration();
                    }
                },
                onVolumeChange(volume, muted) {
                    this.volume = volume;
                    this.muted = muted;
                },
                onRateChange(rate) {
                    this.playbackRate = rate;
                },
                onEnded() {
                    console.log('æ’­æ”¾ç»“æŸ');
                    this.isPlaying = false;
                },
                onError(error) {
                    console.error('æ’­æ”¾é”™è¯¯:', error);
                },
                formatTime(seconds) {
                    if (!seconds || isNaN(seconds)) return '0:00';
                    const mins = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                },
            },
        });
    </script>
</body>
</html>
